<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Game Awards 2025 ‚Äì Prediction Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Simple styling -->
  <style>
    :root {
      --bg: #050814;
      --bg-card: #111827;
      --bg-card-alt: #030712;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
      --danger: #f97373;
      --success: #4ade80;
      --warning: #eab308;
      --radius-xl: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 40%, #000 100%);
      color: var(--text-main);
      padding: 1.5rem;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 1.5rem;
      padding: 1.25rem 1.5rem;
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.08), rgba(15, 23, 42, 0.9));
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);
    }

    header h1 {
      margin: 0;
      font-size: 1.7rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    header p {
      margin: 0.25rem 0;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    header .badge-row {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      font-size: 0.8rem;
    }

    .badge {
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--text-muted);
    }

    .badge-accent {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.15fr);
      gap: 1rem;
    }

    .card {
      background: linear-gradient(145deg, var(--bg-card), var(--bg-card-alt));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      padding: 1rem;
      box-shadow: 0 18px 35px rgba(0, 0, 0, 0.5);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .card-header h2 {
      font-size: 1.1rem;
      margin: 0;
    }

    .card-header small {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .tool-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      margin-top: 0.5rem;
    }

    button,
    label.file-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      padding: 0.45rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.08s ease, background 0.08s ease;
      white-space: nowrap;
    }

    button.primary {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    button:not(:disabled):hover,
    label.file-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.45);
      border-color: rgba(248, 250, 252, 0.15);
    }

    button.small,
    label.file-button.small {
      font-size: 0.78rem;
      padding: 0.3rem 0.7rem;
    }

    label.file-button input[type="file"] {
      display: none;
    }

    .notice {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.4rem;
    }

    .notice strong {
      color: var(--accent);
    }

    .notice.warning {
      color: var(--warning);
    }

    .notice.danger {
      color: var(--danger);
    }

    .notice.success {
      color: var(--success);
    }

    .categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 0.75rem;
      margin-top: 0.25rem;
      max-height: calc(100vh - 230px);
      overflow: auto;
      padding-right: 0.2rem;
    }

    .category-card {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 0.7rem 0.85rem;
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.35), rgba(15, 23, 42, 0.9));
    }

    .category-title {
      font-size: 0.95rem;
      margin-bottom: 0.4rem;
      font-weight: 600;
    }

    .nominee-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.25rem;
    }

    .nominee-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .nominee-item input[type="radio"] {
      accent-color: var(--accent);
      cursor: pointer;
    }

    .nominee-name {
      flex: 1;
      cursor: pointer;
    }

    #results-section {
      margin-top: 0.35rem;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 0.7rem 0.85rem;
      background: radial-gradient(circle at top right, rgba(251, 191, 36, 0.25), rgba(12, 10, 26, 0.96));
      font-size: 0.85rem;
    }

    #results-section h3 {
      margin: 0 0 0.4rem;
      font-size: 0.95rem;
    }

    .winner-select-row {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.1fr);
      gap: 0.35rem;
      align-items: center;
      margin-bottom: 0.35rem;
    }

    .winner-select-row label {
      font-size: 0.8rem;
    }

    select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 0.25rem 0.6rem;
      font-size: 0.78rem;
    }

    select:focus {
      outline: 1px solid var(--accent);
    }

    #results-card {
      margin-top: 0.8rem;
      border-radius: var(--radius-xl);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      padding: 0.75rem 0.85rem;
      background: radial-gradient(circle at top, rgba(15, 118, 110, 0.27), rgba(7, 15, 43, 0.98));
      font-size: 0.83rem;
    }

    #results-card h3 {
      margin: 0 0 0.4rem;
      font-size: 0.95rem;
    }

    #accuracySummary {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    #results-table-container {
      max-height: 300px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background: rgba(15, 23, 42, 0.7);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.75rem;
      min-width: 480px; /* help on very narrow screens */
    }

    thead {
      background: rgba(15, 23, 42, 0.95);
    }

    th,
    td {
      padding: 0.25rem 0.4rem;
      border-bottom: 1px solid rgba(30, 64, 175, 0.5);
      text-align: left;
    }

    th {
      font-weight: 600;
      color: var(--text-muted);
      position: sticky;
      top: 0;
      background: rgba(15, 23, 42, 0.98);
      z-index: 1;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .tag-correct {
      border-color: var(--success);
      color: var(--success);
    }

    .tag-wrong {
      border-color: var(--danger);
      color: var(--danger);
    }

    .tag-missing {
      border-color: var(--warning);
      color: var(--warning);
    }

    footer {
      margin-top: 1rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
    }

    /* ===== MOBILE TWEAKS ===== */

    @media (max-width: 900px) {
      body {
        padding: 1rem;
      }

      .layout {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      header {
        padding: 1rem 1.1rem;
      }

      header h1 {
        font-size: 1.35rem;
      }

      .card {
        padding: 0.85rem;
      }

      .categories {
        max-height: none; /* let the page scroll, easier on mobile */
        padding-right: 0;
      }

      .tool-row {
        gap: 0.35rem;
      }

      button,
      label.file-button {
        font-size: 0.8rem;
        padding: 0.4rem 0.75rem;
      }

      .winner-select-row {
        grid-template-columns: 1fr;
      }

      #results-table-container {
        max-height: 230px;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 0.75rem;
      }

      header h1 {
        font-size: 1.25rem;
      }

      header p {
        font-size: 0.85rem;
      }

      .badge-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .badge {
        width: 100%;
      }

      .tool-row {
        flex-direction: column;
        align-items: stretch;
      }

      button,
      label.file-button {
        width: 100%;
        justify-content: center;
      }

      table {
        font-size: 0.7rem;
        min-width: 420px;
      }
    }
  </style>

  <!-- html2canvas for PNG export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
  <div class="app">
    <header>
      <h1>The Game Awards 2025 ‚Äì Prediction Tracker</h1>
      <p>
        Make your GOTY + category predictions, export them <strong>before the show starts</strong>,
        and later import the file to calculate your accuracy and generate a shareable PNG.
      </p>
      <p>
        <strong>Show time (main broadcast):</strong>
        December 11, 2025 ‚Äì 7:30 PM ET / 4:30 PM PT
        (‚âà 8:30 PM in Dominican Republic, UTC-4).
      </p>

      <div class="badge-row">
        <span class="badge badge-accent">
          ‚è∞ Lock time:
          <span id="lockLocal"></span>
        </span>
        <span class="badge">
          üó≥Ô∏è <span id="categoryCountBadge"></span>
        </span>
        <span class="badge">
          üéÆ Based on official 2025 nominees
        </span>
      </div>
    </header>

    <div class="layout">
      <!-- Left side: Voting categories -->
      <section class="card">
        <div class="card-header">
          <div>
            <h2>1. Make Your Predictions</h2>
            <small>Select one nominee per category (tap again to unselect).</small>
          </div>
        </div>

        <div id="exportNotice" class="notice">
          Exporting predictions will be disabled once the show starts.
          You will still be able to <strong>import past predictions</strong> and compute results.
        </div>

        <div class="tool-row">
          <button id="exportBtn" class="primary" type="button">
            üíæ Export Predictions (.json)
          </button>

          <label class="file-button" for="importFile">
            üìÇ Import Predictions File
            <input id="importFile" type="file" accept=".json,application/json" />
          </label>

          <button id="clearBtn" class="small" type="button">
            ‚ôªÔ∏è Clear selections
          </button>
        </div>

        <div class="categories" id="categoriesContainer">
          <!-- Category cards injected by JS -->
        </div>
      </section>

      <!-- Right side: winners, accuracy & PNG -->
      <section class="card">
        <div class="card-header">
          <div>
            <h2>2. Winners & Accuracy</h2>
            <small>After the show, mark winners and calculate your accuracy.</small>
          </div>
        </div>

        <div id="results-section">
          <h3>Mark Actual Winners</h3>
          <p class="notice">
            Option A: Import your JSON prediction file (even after the lock time) and then choose the real winners from the dropdowns.  
            Option B: Just use your current on-page selections as ‚Äúpredictions‚Äù.
          </p>

          <div id="winnersContainer">
            <!-- Winner selects injected by JS -->
          </div>

          <div class="tool-row" style="margin-top: 0.5rem;">
            <button id="computeBtn" class="primary" type="button">
              ‚úÖ Compute Accuracy
            </button>
            <button id="pngBtn" type="button">
              üñºÔ∏è Download Results as PNG
            </button>
          </div>

          <p id="resultsInfo" class="notice"></p>
        </div>

        <div id="results-card">
          <h3>Prediction Results Summary</h3>
          <div id="accuracySummary">No results yet. Compute accuracy to see your score.</div>

          <div id="results-table-container">
            <table>
              <thead>
              <tr>
                <th style="width: 32%;">Category</th>
                <th style="width: 30%;">Predicted Winner</th>
                <th style="width: 30%;">Actual Winner</th>
                <th style="width: 8%;">Result</th>
              </tr>
              </thead>
              <tbody id="resultsTableBody">
              <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <footer>
          Made for personal prediction tracking. Not affiliated with The Game Awards.
        </footer>
      </section>
    </div>
  </div>

  <script>
    // === CONFIG ===

    // Event start time in UTC. Dec 11, 2025 ‚Äì 7:30 PM ET = 00:30 on Dec 12, 2025 UTC.
    const EVENT_START_UTC = "2025-12-12T00:30:00Z";

    const CATEGORIES = [
      {
        id: "game-of-the-year",
        name: "Game of the Year",
        nominees: [
          "Clair Obscur: Expedition 33",
          "Death Stranding 2: On the Beach",
          "Donkey Kong Bananza",
          "Hades II",
          "Hollow Knight: Silksong",
          "Kingdom Come: Deliverance II"
        ]
      },
      {
        id: "best-game-direction",
        name: "Best Game Direction",
        nominees: [
          "Clair Obscur: Expedition 33",
          "Death Stranding 2: On the Beach",
          "Ghost of Y≈çtei",
          "Hades II",
          "Split Fiction"
        ]
      },
      {
        id: "best-adaptation",
        name: "Best Adaptation",
        nominees: [
          "A Minecraft Movie",
          "Devil May Cry",
          "The Last of Us: Season 2",
          "Splinter Cell: Deathwatch",
          "Until Dawn"
        ]
      },
      {
        id: "best-narrative",
        name: "Best Narrative",
        nominees: [
          "Clair Obscur: Expedition 33",
          "Death Stranding 2: On the Beach",
          "Ghost of Y≈çtei",
          "Kingdom Come: Deliverance II",
          "Silent Hill f"
        ]
      },
      {
        id: "best-art-direction",
        name: "Best Art Direction",
        nominees: [
          "Clair Obscur: Expedition 33",
          "Death Stranding 2: On the Beach",
          "Ghost of Y≈çtei",
          "Hades II",
          "Hollow Knight: Silksong"
        ]
      },
      {
        id: "best-score-music",
        name: "Best Score and Music",
        nominees: [
          "Hollow Knight: Silksong",
          "Hades II",
          "Clair Obscur: Expedition 33",
          "Ghost of Y≈çtei",
          "Death Stranding 2: On the Beach"
        ]
      },
      {
        id: "best-audio-design",
        name: "Best Audio Design",
        nominees: [
          "Battlefield 6",
          "Clair Obscur: Expedition 33",
          "Death Stranding 2: On the Beach",
          "Ghost of Y≈çtei",
          "Silent Hill f"
        ]
      },
      {
        id: "best-performance",
        name: "Best Performance",
        nominees: [
          "Ben Starr",
          "Charlie Cox",
          "Erika Ishii",
          "Jennifer English",
          "Konatsu Kato",
          "Troy Baker"
        ]
      },
      {
        id: "innovation-in-accessibility",
        name: "Innovation in Accessibility",
        nominees: [
          "Assassin‚Äôs Creed Shadows",
          "Atomfall",
          "Doom: The Dark Ages",
          "EA Sports FC 26",
          "South of Midnight"
        ]
      },
      {
        id: "games-for-impact",
        name: "Games for Impact",
        nominees: [
          "Consume Me",
          "Despelote",
          "Lost Records: Bloom & Rage",
          "South of Midnight",
          "Wanderstop"
        ]
      },
      {
        id: "best-ongoing-game",
        name: "Best Ongoing Game",
        nominees: [
          "Final Fantasy XIV",
          "Fortnite",
          "Helldivers 2",
          "Marvel Rivals",
          "No Man's Sky"
        ]
      },
      {
        id: "best-community-support",
        name: "Best Community Support",
        nominees: [
          "Baldur's Gate 3",
          "Final Fantasy XIV",
          "Fortnite",
          "Helldivers 2",
          "No Man's Sky"
        ]
      },
      {
        id: "best-independent-game",
        name: "Best Independent Game",
        nominees: [
          "Absolum",
          "Ball x Pit",
          "Blue Prince",
          "Clair Obscur: Expedition 33",
          "Hades II",
          "Hollow Knight: Silksong"
        ]
      },
      {
        id: "best-debut-indie-game",
        name: "Best Debut Indie Game",
        nominees: [
          "Blue Prince",
          "Clair Obscur: Expedition 33",
          "Despelote",
          "Dispatch"
        ]
      },
      {
        id: "best-mobile-game",
        name: "Best Mobile Game",
        nominees: [
          "Destiny: Rising",
          "Persona 5: The Phantom X",
          "Sonic Rumble",
          "Umamusume: Pretty Derby",
          "Wuthering Waves"
        ]
      },
      {
        id: "best-vr-ar-game",
        name: "Best VR/AR Game",
        nominees: [
          "Alien: Rogue Incursion",
          "Arken Age",
          "Ghost Town",
          "Marvel‚Äôs Deadpool VR",
          "The Midnight Walk"
        ]
      },
      {
        id: "best-action-game",
        name: "Best Action Game",
        nominees: [
          "Battlefield 6",
          "Doom: The Dark Ages",
          "Hades II",
          "Ninja Gaiden 4",
          "Shinobi: Art of Vengeance"
        ]
      },
      {
        id: "best-action-adventure-game",
        name: "Best Action/Adventure Game",
        nominees: [
          "Death Stranding 2: On the Beach",
          "Ghost of Y≈çtei",
          "Indiana Jones and the Great Circle",
          "Hollow Knight: Silksong",
          "Split Fiction"
        ]
      },
      {
        id: "best-rpg",
        name: "Best RPG",
        nominees: [
          "Avowed",
          "Clair Obscur: Expedition 33",
          "Kingdom Come: Deliverance II",
          "The Outer Worlds 2",
          "Monster Hunter Wilds"
        ]
      },
      {
        id: "best-fighting-game",
        name: "Best Fighting Game",
        nominees: [
          "2XKO",
          "Capcom Fighting Collection 2",
          "Fatal Fury: City of the Wolves",
          "Mortal Kombat: Legacy Kollection",
          "Virtua Fighter 5 R.E.V.O. World Stage"
        ]
      },
      {
        id: "best-family-game",
        name: "Best Family Game",
        nominees: [
          "Donkey Kong Bananza",
          "LEGO Party!",
          "LEGO Voyagers",
          "Mario Kart World",
          "Sonic Racing: CrossWorlds",
          "Split Fiction"
        ]
      },
      {
        id: "best-sim-strategy",
        name: "Best Sim/Strategy Game",
        nominees: [
          "The Alters",
          "FINAL FANTASY TACTICS - The Ivalice Chronicles",
          "Jurassic World Evolution 3",
          "Sid Meier's Civilization VII",
          "Tempest Rising",
          "Two Point Museum"
        ]
      },
      {
        id: "best-sports-racing",
        name: "Best Sports/Racing",
        nominees: [
          "EA Sports FC 26",
          "F1 25",
          "Mario Kart World",
          "Rematch",
          "Sonic Racing: CrossWorlds"
        ]
      },
      {
        id: "best-multiplayer",
        name: "Best Multiplayer",
        nominees: [
          "Arc Raiders",
          "Battlefield 6",
          "Elden Ring Nightreign",
          "Peak",
          "Split Fiction"
        ]
      },
      {
        id: "most-anticipated-game",
        name: "Most Anticipated Game",
        nominees: [
          "007 First Light",
          "Grand Theft Auto VI",
          "Marvel's Wolverine",
          "Resident Evil Requiem",
          "The Witcher IV"
        ]
      },
      {
        id: "content-creator-of-the-year",
        name: "Content Creator of the Year",
        nominees: [
          "Caedrel",
          "Kai Cenat",
          "MoistCr1TiKaL",
          "Sakura Miko",
          "The Burnt Peanut"
        ]
      },
      {
        id: "best-esports-game",
        name: "Best Esports Game",
        nominees: [
          "Counter-Strike 2",
          "Dota 2",
          "League of Legends",
          "Mobile Legends: Bang Bang",
          "Valorant"
        ]
      },
      {
        id: "best-esports-athlete",
        name: "Best Esports Athlete",
        nominees: [
          "brawk",
          "Chovy",
          "f0rsakeN",
          "Kakeru",
          "MenaRD",
          "Zyw0o"
        ]
      },
      {
        id: "best-esports-team",
        name: "Best Esports Team",
        nominees: [
          "Gen.G ‚Äì League of Legends",
          "NRG ‚Äì Valorant",
          "Team Falcons ‚Äì Dota 2",
          "Team Liquid PH ‚Äì Mobile Legends: Bang Bang",
          "Team Vitality ‚Äì Counter-Strike 2"
        ]
      },
      {
        id: "players-voice",
        name: "Players' Voice",
        nominees: [
          "Expedition 33",
          "Dispatch",
          "Genshin Impact",
          "Hollow Knight: Silksong",
          "Wuthering Waves"
        ]
      }
    ];

    // === STATE ===
    let importedPredictionData = null; // Last imported JSON object

    // === HELPERS ===

    function formatLockLocal() {
      const d = new Date(EVENT_START_UTC);
      const options = {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
      };
      return d.toLocaleString(undefined, options);
    }

    function isLockedNow() {
      const now = new Date();
      const eventDate = new Date(EVENT_START_UTC);
      return now >= eventDate;
    }

    function downloadFile(contents, filename, mimeType = "application/octet-stream") {
      const blob = new Blob([contents], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function getPredictionsFromUI() {
      const predictions = {};
      for (const cat of CATEGORIES) {
        const name = `cat-${cat.id}`;
        const checked = document.querySelector(`input[name="${name}"]:checked`);
        predictions[cat.id] = checked ? checked.value : null;
      }
      return predictions;
    }

    function applyPredictionsToUI(predictions) {
      for (const cat of CATEGORIES) {
        const predicted = predictions[cat.id];
        const name = `cat-${cat.id}`;
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        radios.forEach(r => r.checked = false);
        if (!predicted) continue;
        const radio = Array.from(radios).find(r => r.value === predicted);
        if (radio) {
          radio.checked = true;
        }
      }
    }

    function clearSelections() {
      document
        .querySelectorAll('input[type="radio"][name^="cat-"]')
        .forEach(r => (r.checked = false));
    }

    function getWinnersFromUI() {
      const winners = {};
      for (const cat of CATEGORIES) {
        const sel = document.getElementById(`winner-${cat.id}`);
        winners[cat.id] = sel ? (sel.value || null) : null;
      }
      return winners;
    }

    function populateResultsTable(predictions, winners) {
      const tbody = document.getElementById("resultsTableBody");
      tbody.innerHTML = "";

      let total = 0;
      let correct = 0;

      for (const cat of CATEGORIES) {
        const predicted = predictions[cat.id];
        const actual = winners[cat.id];

        // Only score categories where you actually made a pick AND there is a winner
        if (actual && predicted) {
          total++;
          if (predicted === actual) {
            correct++;
          }
        }

        const tr = document.createElement("tr");
        const tdCat = document.createElement("td");
        const tdPred = document.createElement("td");
        const tdActual = document.createElement("td");
        const tdResult = document.createElement("td");

        tdCat.textContent = cat.name;
        tdPred.textContent = predicted || "‚Äî";
        tdActual.textContent = actual || "‚Äî";

        const span = document.createElement("span");
        span.classList.add("tag");

        if (!actual) {
          span.textContent = "N/A";
          span.classList.add("tag-missing");
        } else if (!predicted) {
          span.textContent = "No pick";
          span.classList.add("tag-missing");
        } else if (predicted === actual) {
          span.textContent = "Hit";
          span.classList.add("tag-correct");
        } else {
          span.textContent = "Miss";
          span.classList.add("tag-wrong");
        }

        tdResult.appendChild(span);

        tr.appendChild(tdCat);
        tr.appendChild(tdPred);
        tr.appendChild(tdActual);
        tr.appendChild(tdResult);

        tbody.appendChild(tr);
      }

      const summary = document.getElementById("accuracySummary");
      if (total === 0) {
        summary.textContent =
          "No scored categories yet ‚Äì either you haven't set winners or you didn't make picks for those categories.";
      } else {
        const pct = ((correct / total) * 100).toFixed(1);
        summary.textContent =
          `You predicted ${correct} out of ${total} picked categories correctly ` +
          `(${pct}% accuracy).`;
      }
    }

    // === RENDERING ===

    function attachToggleRadios() {
      const radios = document.querySelectorAll('input[type="radio"][name^="cat-"]');
      radios.forEach(radio => {
        const downEvent = window.PointerEvent ? "pointerdown" : "mousedown";

        radio.addEventListener(downEvent, function () {
          this.dataset.wasChecked = this.checked ? "true" : "false";
        });

        radio.addEventListener("click", function () {
          if (this.dataset.wasChecked === "true") {
            this.checked = false;
            this.dataset.wasChecked = "false";
          }
        });
      });
    }

    function renderCategoryCards() {
      const container = document.getElementById("categoriesContainer");
      container.innerHTML = "";
      for (const cat of CATEGORIES) {
        const card = document.createElement("div");
        card.className = "category-card";

        const title = document.createElement("div");
        title.className = "category-title";
        title.textContent = cat.name;
        card.appendChild(title);

        const list = document.createElement("ul");
        list.className = "nominee-list";

        cat.nominees.forEach((nom, index) => {
          const li = document.createElement("li");
          li.className = "nominee-item";

          const input = document.createElement("input");
          input.type = "radio";
          input.name = `cat-${cat.id}`;
          input.id = `cat-${cat.id}-${index}`;
          input.value = nom;

          const label = document.createElement("label");
          label.className = "nominee-name";
          label.htmlFor = input.id;
          label.textContent = nom;

          li.appendChild(input);
          li.appendChild(label);
          list.appendChild(li);
        });

        card.appendChild(list);
        container.appendChild(card);
      }

      const badge = document.getElementById("categoryCountBadge");
      if (badge) {
        badge.textContent = `${CATEGORIES.length} TGA 2025 categories`;
      }

      attachToggleRadios();
    }

    function renderWinnerSelects() {
      const container = document.getElementById("winnersContainer");
      container.innerHTML = "";

      for (const cat of CATEGORIES) {
        const row = document.createElement("div");
        row.className = "winner-select-row";

        const label = document.createElement("label");
        label.htmlFor = `winner-${cat.id}`;
        label.textContent = cat.name;

        const select = document.createElement("select");
        select.id = `winner-${cat.id}`;

        const optEmpty = document.createElement("option");
        optEmpty.value = "";
        optEmpty.textContent = "‚Äî Winner not set ‚Äî";
        select.appendChild(optEmpty);

        for (const nom of cat.nominees) {
          const opt = document.createElement("option");
          opt.value = nom;
          opt.textContent = nom;
          select.appendChild(opt);
        }

        row.appendChild(label);
        row.appendChild(select);
        container.appendChild(row);
      }
    }

    // === MAIN LOGIC ===

    document.addEventListener("DOMContentLoaded", () => {
      // Render initial UI
      renderCategoryCards();
      renderWinnerSelects();

      // Lock time text
      document.getElementById("lockLocal").textContent = formatLockLocal();

      function updateExportLock() {
        const locked = isLockedNow();
        const exportBtn = document.getElementById("exportBtn");
        const notice = document.getElementById("exportNotice");
        if (locked) {
          exportBtn.disabled = true;
          notice.textContent =
            "The show has started (or already passed). Exporting new prediction files is now locked. You can still import your saved JSON, set winners, compute accuracy, and export the PNG.";
          notice.classList.add("danger");
        } else {
          exportBtn.disabled = false;
          notice.textContent =
            "You can export your predictions as a JSON file until the show starts. You will always be able to import past predictions and compute results.";
          notice.classList.remove("danger");
        }
      }

      updateExportLock();
      setInterval(updateExportLock, 60 * 1000);

      // Export predictions
      document.getElementById("exportBtn").addEventListener("click", () => {
        if (isLockedNow()) {
          alert("Exporting is locked because the show start time has passed. You can still import previous prediction files and see your results.");
          return;
        }

        const predictions = getPredictionsFromUI();
        const hasAny = Object.values(predictions).some(v => v !== null);
        if (!hasAny) {
          if (!confirm("You haven't selected any predictions yet. Export an empty file anyway?")) {
            return;
          }
        }

        const payload = {
          version: 1,
          createdAt: new Date().toISOString(),
          eventStartUtc: EVENT_START_UTC,
          categories: CATEGORIES.map(c => ({
            id: c.id,
            name: c.name,
            nominees: c.nominees
          })),
          predictions
        };

        downloadFile(
          JSON.stringify(payload, null, 2),
          "tga-2025-predictions.json",
          "application/json"
        );

        alert("Predictions exported. Keep this file safe to import after the show.");
      });

      // Import predictions (freeze editing, but always allow results)
      document.getElementById("importFile").addEventListener("change", e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = evt => {
          try {
            const obj = JSON.parse(evt.target.result);
            if (typeof obj !== "object" || obj === null) throw new Error("Invalid JSON");

            if (!obj.predictions || !obj.eventStartUtc) {
              throw new Error("Missing predictions or eventStartUtc");
            }

            importedPredictionData = obj;
            applyPredictionsToUI(obj.predictions);

            // Freeze prediction editing after import (still visible)
            document
              .querySelectorAll('input[type="radio"][name^="cat-"]')
              .forEach(r => (r.disabled = true));
            const clearBtn = document.getElementById("clearBtn");
            if (clearBtn) clearBtn.disabled = true;

            const info = document.getElementById("resultsInfo");
            info.textContent =
              "Predictions imported and locked (read-only). You can now select winners and compute accuracy, even if the export time is locked.";
            info.classList.add("success");

            if (obj.createdAt && obj.eventStartUtc) {
              const created = new Date(obj.createdAt);
              const eventDate = new Date(obj.eventStartUtc);
              if (created > eventDate) {
                info.textContent +=
                  " (Warning: imported file was created after the event start time.)";
                info.classList.add("warning");
              }
            }

            const winners = getWinnersFromUI();
            const anyWinner = Object.values(winners).some(v => v !== null);
            if (anyWinner) {
              populateResultsTable(obj.predictions, winners);
            }
          } catch (err) {
            console.error(err);
            alert("Could not parse prediction file. Make sure it's a valid JSON export from this tool.");
          }
        };
        reader.readAsText(file);
      });

      // Clear selections
      document.getElementById("clearBtn").addEventListener("click", () => {
        if (!confirm("Clear all prediction selections?")) return;
        clearSelections();
        importedPredictionData = null;
      });

      // Compute accuracy (always enabled)
      document.getElementById("computeBtn").addEventListener("click", () => {
        const winners = getWinnersFromUI();
        const predictions = importedPredictionData
          ? importedPredictionData.predictions
          : getPredictionsFromUI();

        populateResultsTable(predictions, winners);

        const info = document.getElementById("resultsInfo");
        info.textContent =
          "Accuracy computed. Scroll through the table below and use the PNG button to export a shareable image.";
        info.classList.add("success");
      });

      // PNG export ‚Äì ensure full table, not cut off
      document.getElementById("pngBtn").addEventListener("click", () => {
        const target = document.getElementById("results-card");
        const tableContainer = document.getElementById("results-table-container");
        if (!target || !tableContainer) return;

        const prevMaxHeight = tableContainer.style.maxHeight;
        const prevOverflowY = tableContainer.style.overflowY;
        const prevOverflowX = tableContainer.style.overflowX;

        tableContainer.style.maxHeight = "none";
        tableContainer.style.overflowY = "visible";
        tableContainer.style.overflowX = "visible";

        html2canvas(target, {
          scale: 2,
          useCORS: true
        }).then(canvas => {
          tableContainer.style.maxHeight = prevMaxHeight;
          tableContainer.style.overflowY = prevOverflowY;
          tableContainer.style.overflowX = prevOverflowX;

          canvas.toBlob(blob => {
            if (!blob) {
              alert("Could not generate PNG blob.");
              return;
            }
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "tga-2025-prediction-results.png";
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          }, "image/png");
        }).catch(err => {
          console.error(err);
          tableContainer.style.maxHeight = prevMaxHeight;
          tableContainer.style.overflowY = prevOverflowY;
          tableContainer.style.overflowX = prevOverflowX;
          alert("Error generating PNG. Check console for details.");
        });
      });
    });
  </script>
</body>
</html>
